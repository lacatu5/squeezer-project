id: user-idor
info:
  name: User Profile IDOR Vulnerability
  severity: high
  description: Detects IDOR on user profile endpoints
  tags:
    - idor
    - access-control

variables:
  attacker_email: "{{ATTACKER_EMAIL}}"
  attacker_password: "{{ATTACKER_PASSWORD}}"
  victim_email: "{{VICTIM_EMAIL}}"
  victim_password: "{{VICTIM_PASSWORD}}"

requests:
  - name: Attacker login
    method: POST
    path: /rest/user/login
    headers:
      Content-Type: application/json
    body: '{"email": "{{attacker_email}}", "password": "{{attacker_password}}"}'
    extractors:
      - type: json
        name: attacker_token
        selector: "$.authentication.token"
      - type: json
        name: attacker_user_id
        selector: "$.user.id"

  - name: Victim login
    method: POST
    path: /rest/user/login
    headers:
      Content-Type: application/json
    body: '{"email": "{{victim_email}}", "password": "{{victim_password}}"}'
    extractors:
      - type: json
        name: victim_user_id
        selector: "$.user.id"

  - name: Try sequential user ID
    method: GET
    path: /api/Users/{{victim_user_id}}
    headers:
      Authorization: "Bearer {{attacker_token}}"
    matchers:
      - type: status
        values: [200]
      - type: word
        words: ["email", "password", "securityQuestion"]
        condition: or
    on_match:
      vulnerability: INSECURE_DIRECT_OBJECT_REFERENCE
      message: Can access other user profiles by ID
      remediation: Enforce strict authorization checks on user data access
