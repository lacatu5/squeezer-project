id: generic-jwt-weak-secret
info:
  name: JWT Weak Signing Key
  severity: high
  description: Tests JWT with commonly used weak signing secrets
  tags:
    - jwt
    - cryptography
    - weak-credentials
    - generic

variables:
  login_user: "{{AUTH_USERNAME}}"
  login_password: "{{AUTH_PASSWORD}}"

requests:
  - name: Authenticate to get JWT
    method: POST
    path: "{{login_endpoint}}"
    headers:
      Content-Type: "application/json"
    body: '{"username": "{{login_user}}", "password": "{{login_password}}"}'
    extractors:
      - type: json
        name: original_token
        selector: "{{jwt_token_selector}}"

  - name: Test with common weak secret "secret"
    method: GET
    path: "{{protected_endpoint}}"
    headers:
      Authorization: "Bearer {{jwt_weak_sign(original_token, secret)}}"
    matchers:
      - type: status
        values: [200]

  - name: Test with common weak secret "password"
    method: GET
    path: "{{protected_endpoint}}"
    headers:
      Authorization: "Bearer {{jwt_weak_sign(original_token, password)}}"
    matchers:
      - type: status
        values: [200]

  - name: Test with empty secret
    method: GET
    path: "{{protected_endpoint}}"
    headers:
      Authorization: "Bearer {{jwt_weak_sign(original_token, )}}"
    matchers:
      - type: status
        values: [200]
    on_match:
      vulnerability: JWT_WEAK_SECRET
      message: JWT signed with weak or empty signing key
      remediation: Use strong, random signing keys (minimum 256 bits for HS256)
      evidence_strength: direct_observation
