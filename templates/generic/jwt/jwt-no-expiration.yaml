id: generic-jwt-no-expiration
info:
  name: JWT Missing Expiration Validation
  description: Tests if server accepts JWT without expiration claim
  tags:
    - jwt
    - session-management
    - generic

variables:
  login_user: "{{AUTH_USERNAME}}"
  login_password: "{{AUTH_PASSWORD}}"

requests:
  - name: Authenticate to get JWT
    method: POST
    path: "{{login_endpoint}}"
    headers:
      Content-Type: "application/json"
    body: '{"username": "{{login_user}}", "password": "{{login_password}}"}'
    extractors:
      - type: json
        name: original_token
        selector: "{{jwt_token_selector}}"

  - name: Test access with token that has no expiration
    method: GET
    path: "{{protected_endpoint}}"
    headers:
      Authorization: "Bearer {{jwt_no_exp(original_token)}}"
    matchers:
      - type: status
        values: [200]
    on_match:
      vulnerability: JWT_NO_EXPIRATION
      message: Server accepts JWT without expiration - sessions never expire
      remediation: Always require and validate 'exp' claim in JWT
      evidence_strength: direct_observation
