id: generic-graphql-introspection
info:
  name: GraphQL Introspection Enabled
  description: Tests for exposed GraphQL schema via introspection
  owasp_category: A05:2021
  severity: low
  tags:
    - graphql
    - introspection
    - disclosure
    - generic

requests:
  - name: GraphQL introspection via /graphql
    method: POST
    path: /graphql
    headers:
      Content-Type: application/json
    body: '{"query": "{ __schema { types { name } } }"}'
    matchers:
      - type: word
        words:
          - "__schema"
          - "Query"
          - "Mutation"
        condition: and
        case_sensitive: false
        part: body
      - type: status
        condition: in
        status:
          - 200
        part: header
    matchers_condition: and
    on_match:
      vulnerability: GRAPHQL_INTROSPECTION
      message: GraphQL introspection enabled - schema exposed
      remediation: Disable introspection in production GraphQL servers

  - name: GraphQL introspection via /api/graphql
    method: POST
    path: /api/graphql
    headers:
      Content-Type: application/json
    body: '{"query": "{ __schema { types { name } } }"}'
    matchers:
      - type: word
        words:
          - "__schema"
          - "types"
        condition: and
        case_sensitive: false
        part: body
    on_match:
      vulnerability: GRAPHQL_INTROSPECTION
      message: GraphQL introspection enabled via /api/graphql
      remediation: Disable introspection in production
