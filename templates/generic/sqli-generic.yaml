id: generic-sqli
info:
  name: SQL Injection (Error-Based)
  description: Tests for SQL injection on all discovered API endpoints
  owasp_category: A03:2021
  severity: critical
  tags:
    - sqli
    - injection
    - generic
    - dast

requests:
  - name: SQLi single quote
    method: GET
    path: @params@?value=1'
    matchers:
      - type: regex
        condition: or
        case_sensitive: false
        part: body
        regex:
          - "SQL syntax.{0,200}?MySQL"
          - "Warning.{0,200}?\\Wmysqli?_"
          - "MySQLSyntaxErrorException"
          - "check the manual that (corresponds|fits)"
          - "Unknown column"
          - "SQLSTATE\\[\\d+\\]: Syntax error"
          - "PostgreSQL.{0,200}?ERROR"
          - "PG::SyntaxError:"
          - "ORA-\\d{5}"
          - "Unclosed quotation mark"
          - "SQLite error"
    on_match:
      vulnerability: SQL_INJECTION_SINGLE_QUOTE
      message: SQL injection detected via single quote
      remediation: Use parameterized queries and input validation

  - name: SQLi double quote
    method: GET
    path: @params@?value=1"
    matchers:
      - type: regex
        condition: or
        case_sensitive: false
        part: body
        regex:
          - "SQL syntax.{0,200}?MySQL"
          - "PostgreSQL.{0,200}?ERROR"
          - "ORA-\\d{5}"
          - "Unclosed quotation mark"
    on_match:
      vulnerability: SQL_INJECTION_DOUBLE_QUOTE
      message: SQL injection via double quote
      remediation: Use parameterized queries

  - name: SQLi OR bypass
    method: GET
    path: @params@?value=1' OR '1'='1
    matchers:
      - type: regex
        condition: or
        case_sensitive: false
        part: body
        regex:
          - "SQL syntax.{0,200}?MySQL"
          - "PostgreSQL.{0,200}?ERROR"
          - "ORA-\\d{5}"
    on_match:
      vulnerability: SQL_INJECTION_OR_BYPASS
      message: SQL injection via OR bypass attempt
      remediation: Use parameterized queries

  - name: SQLi UNION
    method: GET
    path: @params@?value=1' UNION SELECT NULL--
    matchers:
      - type: regex
        condition: or
        case_sensitive: false
        part: body
        regex:
          - "SQL syntax.{0,200}?MySQL"
          - "PostgreSQL.{0,200}?ERROR"
          - "ORA-\\d{5}"
    on_match:
      vulnerability: SQL_INJECTION_UNION
      message: SQL injection via UNION SELECT
      remediation: Use parameterized queries
