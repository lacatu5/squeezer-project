id: generic-open-redirect
info:
  name: Open URL Redirect
  description: Tests for open redirect on all endpoints
  owasp_category: A01:2021
  severity: medium
  tags:
    - redirect
    - phishing
    - generic
    - dast

requests:
  - name: Open redirect url param
    method: GET
    path: @params@?url=https://evil.com
    matchers:
      - type: status
        condition: in
        status:
          - 301
          - 302
          - 303
          - 307
          - 308
      - type: word
        part: header
        words:
          - "evil.com"
        case_sensitive: false
    matchers_condition: and
    on_match:
      vulnerability: OPEN_REDIRECT_URL
      message: Open redirect via url parameter
      remediation: Validate redirect URLs against whitelist

  - name: Open redirect next param
    method: GET
    path: @params@?next=https://evil.com
    matchers:
      - type: status
        condition: in
        status:
          - 301
          - 302
          - 303
          - 307
          - 308
      - type: word
        part: header
        words:
          - "evil.com"
        case_sensitive: false
    matchers_condition: and
    on_match:
      vulnerability: OPEN_REDIRECT_NEXT
      message: Open redirect via next parameter
      remediation: Use CSRF tokens with redirects

  - name: Open redirect target param
    method: GET
    path: @params@?target=//evil.com
    matchers:
      - type: status
        condition: in
        status:
          - 301
          - 302
          - 303
          - 307
          - 308
      - type: word
        part: header
        words:
          - "//evil.com"
        case_sensitive: false
    matchers_condition: and
    on_match:
      vulnerability: OPEN_REDIRECT_TARGET
      message: Open redirect via protocol-relative URL
      remediation: Reject protocol-relative URLs
