id: juice-shop-negative-quantity
info:
  name: Negative Quantity Business Logic Flaw
  description: Input validation bypass - server accepts negative values allowing refund abuse
  owasp_category: A02:2025
  severity: high
  tags:
    - business-logic
    - input-validation
    - refund-abuse

requests:
  - name: Add item with negative quantity without auth
    method: POST
    path: /api/BasketItems/
    headers:
      Content-Type: application/json
    body: '{"ProductId": 1, "quantity": -1}'
    matchers:
      - type: status
        values: [200, 201]
    on_match:
      vulnerability: NEGATIVE_QUANTITY
      message: Server accepts negative quantity without authentication - business logic flaw
      remediation: Validate quantity is a positive integer (>= 1) and require authentication

  - name: Add item with negative quantity with auth
    method: POST
    path: /api/BasketItems/
    headers:
      Authorization: "Bearer {{bearer_token}}"
      Content-Type: application/json
    body: '{"ProductId": 1, "quantity": -1}'
    matchers:
      - type: status
        values: [200, 201]
      - type: word
        words:
          - quantity
        condition: and
    on_match:
      vulnerability: NEGATIVE_QUANTITY
      message: Server accepts negative quantity values - allows total manipulation
      remediation: Validate quantity is a positive integer (>= 1) on server side
