id: juice-shop-file-upload-bypass
info:
  name: File Upload Validation Bypass
  author: dast-mvp
  owasp_category: A01:2025
  severity: high
  description: Tests for file upload validation bypass vulnerabilities
  tags:
    - file-upload
    - input-validation
    - misconfiguration

requests:
  - path: /file-upload
    method: POST
    headers:
      Content-Type: multipart/form-data
    matchers:
      - type: status
        status:
          - 200
          - 204
          - 410
    on_match:
      vulnerability: FILE_UPLOAD_BYPASS
      message: File upload endpoint accepts requests without proper validation
      remediation: Implement strict file type validation; whitelist allowed extensions only

  - path: /api/Complaints
    method: POST
    headers:
      Content-Type: application/json
    body: '{"message":"test complaint","file":"../../../etc/passwd"}'
    matchers_condition: and
    matchers:
      - type: status
        status:
          - 200
          - 201
      - type: word
        words:
          - '"status":"success"'
    on_match:
      vulnerability: PATH_TRAVERSAL
      message: Complaints endpoint accepts path traversal in file parameter - may access arbitrary files
      remediation: Validate file paths; use basename() to extract filename only

  - path: /profile/image/upload
    method: POST
    matchers_condition: and
    matchers:
      - type: status
        status:
          - 200
          - 204
      - type: word
        words:
          - '"status":"success"'
          - 'profileImage'
        condition: or
    on_match:
      vulnerability: UNRESTRICTED_FILE_UPLOAD
      message: Profile image upload accepts files without proper validation
      remediation: Validate MIME type server-side; implement file content inspection not just extension
